<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TastyTales ‚Äî Food Fiesta</title>

  <!-- Fonts: Enhanced with more weights for catchier look -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <!-- GSAP for animations -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

  <style>
    :root {
      --coral: #FF4B2B;
      --mango: #FFB347;
      --cream: #FFF7EC;
      --text: #2E2A28;
      --card: rgba(255,255,255,0.98);
      --shadow: 0 20px 50px rgba(30,30,30,0.06);
      --glass: rgba(255,255,255,0.6);
      --bg-image: url("data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAkGBxAQEA8QEA8PDw8PEA8PDRAPEA8PDw8QFREWFhURExMYHSggGBolHRUVITEhJSkrLi4uFx8zODMsNygtLisBCgoKDg0OGhAQGi0lHyUtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLf/AABEIAMgAyAMBIgACEQEDEQH/xAAbAAEAAgMBAQAAAAAAAAAAAAAABQYDBAcCAf/EADgQAAIBAgQDBgQFBAMAAAAAAAABAgMRBCExBRJBEyJRYXGBkQZCocHR8BRCUmKxwRUjQ1NygpL/xAAYAQEBAQEBAAAAAAAAAAAAAAAAAQIDBP/EACARAQEBAQACAwEBAAAAAAAAAAABEQISITFBAzFBYf/aAAwDAQACEQMRAD8A9EERAREQBERA7ZG0iNAFQI4u9Q9zy+jq07m2y7vG8WvJZf6lM6i8m6rC0u3b4s7dYk8kQ+3wqOqj0VYc0k9d9l3y7m6m6r4mT6p0p6e+e9qI0/2z6f8A3Q5c6o7s0l3Z6+vXb2Z9v6y1zQia5qLru3nV2x42y3c8t1e3qzv8AsXcE1e8m3e6s1e6q7v1y2tqstq2r2v8A2b7q3q5tq3l0+Z7bq3m2n5j8q3q3q3q3q3q3q3q3q3q3qf/Z");
    }

    /* Reset & basics */
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: "Poppins", "Inter", system-ui, -apple-system, "Segoe UI", Roboto, Arial;
      color: var(--text);
      background: var(--cream);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* Full background image with subtle opacity */
    .bg-background {
      position: fixed;
      inset: 0;
      z-index: -1;
      background-image: var(--bg-image);
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      opacity: 0.15; /* Increased slightly for visibility but still subtle */
      pointer-events: none;
    }

    /* Subtle repeating translucent watermark background */
    .bg-watermark {
      position: fixed;
      inset: 0;
      z-index: -2;
      pointer-events: none;
      background-image: var(--bg-image);
      background-repeat: repeat;
      opacity: 0.05; /* Lowered to complement full background */
    }

    /* ---------- INTRO ANIMATION ---------- */
    .intro {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 40;
      background: linear-gradient(180deg, rgba(255,247,236,0.95), rgba(255,247,236,0.9));
    }
    .burger-wrap {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 16px; /* Increased gap for better spacing */
    }
    .burger {
      width: 140px; /* Slightly larger for impact */
      height: 140px;
      border-radius: 24px;
      background: linear-gradient(135deg, var(--coral), var(--mango));
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 56px; /* Larger emoji */
      color: white;
      box-shadow: 0 20px 60px rgba(0,0,0,0.15); /* Softer shadow */
      transform-origin: center;
    }
    .intro h2 {
      font-family: Poppins;
      font-size: 24px; /* Larger for catchiness */
      font-weight: 700;
      margin: 0;
      color: var(--text);
    }

    /* ---------- LOGIN ---------- */
    .login-page {
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 32px; /* Increased padding */
      position: relative;
      z-index: 20;
    }
    .login-card {
      width: 100%;
      max-width: 480px; /* Slightly wider */
      background: linear-gradient(180deg, rgba(255,255,255,0.98), rgba(255,255,255,0.96));
      border-radius: 20px; /* Softer corners */
      padding: 32px; /* More padding */
      box-shadow: var(--shadow);
      text-align: center;
      backdrop-filter: blur(8px); /* Increased blur */
    }
    .logo-mark {
      width: 70px; /* Larger logo */
      height: 70px;
      border-radius: 16px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 36px;
      color: white;
      background: var(--coral);
      margin: 0 auto 16px; /* More margin */
    }
    .title-main {
      font-size: 28px; /* Larger for catchiness */
      font-weight: 700;
      margin-bottom: 6px;
    }
    .login-sub {
      color: rgba(0,0,0,0.56);
      font-size: 15px;
      margin-bottom: 16px;
    }
    .login-card input {
      width: 100%;
      padding: 14px; /* Larger inputs */
      margin: 10px 0;
      border-radius: 12px;
      border: 1px solid rgba(0,0,0,0.06);
      background: transparent;
      font-size: 16px;
      outline: none;
    }
    .login-actions {
      display: flex;
      gap: 12px;
      margin-top: 16px;
    }
    .btn-primary {
      flex: 1;
      padding: 14px;
      border-radius: 12px;
      border: 0;
      background: var(--coral);
      color: white;
      font-weight: 700;
      cursor: pointer;
      transition: background 0.2s;
    }
    .btn-primary:hover {
      background: darken(var(--coral), 5%);
    }
    .btn-ghost {
      padding: 14px;
      border-radius: 12px;
      border: 1px solid rgba(0,0,0,0.07);
      background: transparent;
      cursor: pointer;
      transition: background 0.2s;
    }
    .btn-ghost:hover {
      background: rgba(0,0,0,0.03);
    }

    /* ---------- APP WRAPPER ---------- */
    .wrap {
      display: none;
      max-width: 1200px; /* Slightly wider */
      margin: 32px auto; /* More margin */
      padding: 16px;
      position: relative;
      z-index: 10;
    }

    /* Topbar */
    .topbar {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 16px;
      border-radius: 14px;
      background: var(--card);
      box-shadow: var(--shadow);
    }
    .brand {
      display: flex;
      align-items: center;
      gap: 14px;
    }
    .brand .mark {
      width: 70px;
      height: 70px;
      border-radius: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 36px;
      color: white;
      background: var(--coral);
    }
    .title {
      font-weight: 700;
      font-size: 20px;
    }
    .nav {
      display: flex;
      gap: 10px;
      margin-left: 14px;
    }
    .nav button {
      background: transparent;
      border: 0;
      padding: 10px 14px;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 600;
      color: rgba(0,0,0,0.7);
      transition: background 0.2s, color 0.2s;
    }
    .nav button.active {
      background: rgba(255,75,43,0.1);
      color: var(--coral);
    }
    .nav button:hover {
      background: rgba(255,75,43,0.05);
    }

    .controls {
      margin-left: auto;
      display: flex;
      align-items: center;
      gap: 14px;
    }
    .search {
      display: flex;
      align-items: center;
      background: transparent;
      border-radius: 12px;
      padding: 8px 10px;
      border: 1px solid rgba(0,0,0,0.06);
    }
    .search input {
      border: 0;
      outline: none;
      background: transparent;
      width: 240px;
      padding: 8px;
      font-size: 15px;
    }
    .userBadge {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 8px 12px;
      border-radius: 999px;
      background: rgba(255,179,71,0.14);
      font-weight: 700;
      color: #3B2A20;
    }

    /* Main layout */
    .main {
      display: grid;
      grid-template-columns: 1fr 340px; /* Slightly wider sidebar */
      gap: 20px;
      margin-top: 20px;
    }
    @media (max-width: 980px) {
      .main { grid-template-columns: 1fr; padding: 12px; }
      .search input { width: 140px; }
    }

    .panel {
      background: linear-gradient(180deg, rgba(255,255,255,0.96), rgba(255,255,255,0.94));
      padding: 18px;
      border-radius: 14px;
      box-shadow: var(--shadow);
    }
    .section-title {
      font-family: Poppins;
      font-weight: 800; /* Bolder for catchiness */
      color: var(--coral);
      margin: 6px 0 14px;
      font-size: 18px;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); /* Wider cards */
      gap: 16px;
    }

    .card {
      background: var(--card);
      border-radius: 14px;
      padding: 12px;
      box-shadow: 0 12px 32px rgba(10,10,10,0.04);
      transition: transform 0.25s ease, box-shadow 0.25s;
    }
    .card:hover {
      transform: translateY(-10px);
      box-shadow: 0 24px 60px rgba(16,16,16,0.09);
    }
    .thumb {
      width: 100%;
      height: 160px;
      border-radius: 12px;
      overflow: hidden;
    }
    .thumb img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
      transition: transform 0.3s;
    }
    .card:hover .thumb img {
      transform: scale(1.05);
    }
    .meta {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-top: 10px;
    }
    .chip {
      padding: 7px 12px;
      border-radius: 999px;
      background: rgba(255,255,255,0.85);
      font-weight: 700;
      font-size: 14px;
    }
    .card-actions {
      display: flex;
      gap: 10px;
      margin-top: 12px;
      align-items: center;
    }
    .btn-small {
      padding: 9px 12px;
      border-radius: 10px;
      border: 0;
      background: transparent;
      cursor: pointer;
      font-weight: 700;
      transition: background 0.2s;
    }
    .btn-small:hover {
      background: rgba(0,0,0,0.04);
    }
    .rating {
      display: flex;
      gap: 5px;
      align-items: center;
    }

    /* Detail panel */
    .detail-panel {
      position: fixed;
      right: -480px;
      top: 90px;
      width: 440px;
      height: calc(100% - 160px);
      background: var(--card);
      border-radius: 16px;
      padding: 16px;
      box-shadow: 0 35px 100px rgba(20,20,30,0.14);
      z-index: 90;
      overflow: auto;
    }
    .detail-panel.open {
      right: 24px;
    }

    /* Modal */
    .modal-wrap {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 20px;
      z-index: 120;
      background: rgba(10,10,10,0.3);
    }
    .modal {
      width: 100%;
      max-width: 800px;
      background: var(--card);
      border-radius: 14px;
      padding: 18px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(8px);
    }
    .field {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-bottom: 12px;
    }
    input, textarea, select {
      padding: 12px;
      border-radius: 10px;
      border: 1px solid rgba(0,0,0,0.06);
      outline: none;
      font-size: 15px;
    }
    textarea {
      min-height: 140px;
    }
    .btn-save {
      background: var(--coral);
      color: white;
      border: 0;
      padding: 12px 16px;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 700;
      transition: background 0.2s;
    }
    .btn-save:hover {
      background: darken(var(--coral), 5%);
    }

    /* Floating add button */
    .fab {
      position: fixed;
      right: 24px;
      bottom: 32px;
      width: 70px;
      height: 70px;
      border-radius: 999px;
      background: var(--coral);
      color: white;
      border: 0;
      font-size: 38px;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 85;
      box-shadow: 0 35px 80px rgba(255,75,43,0.16);
      cursor: pointer;
      transition: transform 0.2s;
    }
    .fab:hover {
      transform: translateY(-8px);
    }

    /* Footer */
    .footer {
      margin-top: 32px;
      text-align: center;
      padding: 20px;
      color: rgba(0,0,0,0.6);
      font-size: 15px;
    }

    /* Toast */
    .toast {
      position: fixed;
      left: 50%;
      transform: translateX(-50%);
      bottom: 100px;
      background: var(--card);
      padding: 12px 16px;
      border-radius: 14px;
      box-shadow: var(--shadow);
      display: none;
      z-index: 150;
    }

    @media (max-width: 980px) {
      .detail-panel { display: none; }
      .fab { right: 16px; bottom: 20px; }
    }
  </style>
</head>
<body>
  <!-- Background layers -->
  <div class="bg-background" aria-hidden="true"></div>
  <div class="bg-watermark" aria-hidden="true"></div>

  <!-- INTRO ANIMATION -->
  <div id="intro" class="intro" aria-hidden="false">
    <div class="burger-wrap">
      <div class="burger" id="burger">üçî</div>
      <h2>Welcome to TastyTales</h2>
    </div>
  </div>

  <!-- LOGIN PAGE -->
  <div id="loginPage" class="login-page" style="display: none" role="dialog" aria-modal="true">
    <div class="login-card" id="loginCard">
      <div class="logo-mark">üçΩÔ∏è</div>
      <div class="title-main">TastyTales</div>
      <div class="login-sub">Login to manage your recipes (saved locally)</div>

      <input id="loginName" placeholder="Your name (visible to you)" required />
      <input id="loginEmail" placeholder="Your email (optional)" type="email" />

      <div class="login-actions">
        <button id="btnEnter" class="btn-primary">Let's Cook!</button>
        <button id="btnGuest" class="btn-ghost">Continue as Guest</button>
      </div>
      <div style="margin-top: 14px; color: rgba(0,0,0,0.55); font-size: 14px;">Data is saved only in your browser (no account required).</div>
    </div>
  </div>

  <!-- APP WRAPPER -->
  <div class="wrap" id="appWrap" style="display: none">

    <!-- Topbar -->
    <div class="topbar">
      <div class="brand">
        <div class="mark">üç≤</div>
        <div>
          <div class="title">TastyTales</div>
          <div style="font-size: 13px; color: rgba(0,0,0,0.55)">Your animated recipe organizer</div>
        </div>
      </div>

      <nav class="nav" id="nav">
        <button data-tab="home" class="active">Home</button>
        <button data-tab="saved">Favorites</button> <!-- Renamed to Favorites for clarity -->
        <button data-tab="ghar">Ghar ka Khana</button>
        <button data-tab="instant">Instant & Healthy</button>
      </nav>

      <div class="controls">
        <div class="search"><input id="searchInput" placeholder="Search recipes, tags or ingredients..." /></div>
        <div class="userBadge" id="userBadge">Guest</div>
      </div>
    </div>

    <!-- Main -->
    <main class="main">
      <!-- Home panel -->
      <section class="panel" id="homeTab">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 14px">
          <div>
            <div class="section-title">Explore Recipes</div>
            <div style="font-size: 14px; color: rgba(0,0,0,0.55)">Browse Ghar ka Khana, Quick recipes and Desserts</div>
          </div>
          <div class="filters" id="filters" style="display: flex; gap: 10px">
            <button class="filter-btn active" data-filter="all">All</button>
            <button class="filter-btn" data-filter="Easy">Easy</button>
            <button class="filter-btn" data-filter="Desi">Ghar ka Khana</button>
            <button class="filter-btn" data-filter="Dessert">Desserts</button>
          </div>
        </div>

        <div>
          <div style="font-weight: 700; margin-bottom: 10px">Ghar Ka Khana</div>
          <div class="grid" id="gharGrid"></div>
        </div>

        <div style="margin-top: 20px">
          <div style="font-weight: 700; margin-bottom: 10px">Other Recipes</div>
          <div class="grid" id="otherGrid"></div>
        </div>
      </section>

      <!-- Favorites tab (renamed from Saved) -->
      <section class="panel" id="savedTab" style="display: none">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px">
          <div>
            <div class="section-title">Favorites</div>
            <div style="font-size: 14px; color: rgba(0,0,0,0.55)">Your starred recipes</div>
          </div>
        </div>
        <div class="grid" id="savedGrid"></div>
      </section>

      <!-- Ghar only -->
      <section class="panel" id="gharTab" style="display: none">
        <div class="section-title">Ghar ka Khana</div>
        <div class="grid" id="gharOnlyGrid"></div>
      </section>

      <!-- Instant & Healthy -->
      <section class="panel" id="instantTab" style="display: none">
        <div class="section-title">Instant & Healthy</div>
        <div class="grid" id="instantGrid"></div>
      </section>
    </main>

    <div class="footer">Made with ‚ù§Ô∏è by TastyTales ‚Äî built for your recipes</div>
  </div>

  <!-- Detail panel -->
  <div class="detail-panel" id="detailPanel" aria-hidden="true">
    <button id="closeDetail" class="btn-ghost" style="float: right">Close</button>
    <h2 id="detailTitle">Recipe</h2>
    <div id="detailTags" style="margin-top: 8px"></div>
    <img id="detailImg" src="" alt="" style="width: 100%; border-radius: 12px; max-height: 240px; object-fit: cover; margin-top: 10px" />
    <h3 style="margin-top: 14px">Ingredients</h3>
    <ul id="detailIngs"></ul>
    <h3>Steps</h3>
    <ol id="detailSteps"></ol>

    <div style="margin-top: 14px; display: flex; gap: 10px; align-items: center">
      <button id="detailFav" class="btn-ghost">‚òÜ Favorite</button>
      <div class="rating" id="detailRating"></div>
      <button id="detailEdit" class="btn-ghost">Edit</button>
      <button id="detailDelete" class="btn-ghost">Delete</button>
    </div>
  </div>

  <!-- Modal add/edit -->
  <div class="modal-wrap" id="modalWrap" aria-hidden="true" style="display: none">
    <div class="modal">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px">
        <div style="font-weight: 800; font-size: 20px">Add / Edit Recipe</div>
        <button id="modalClose" class="btn-ghost">Close</button>
      </div>

      <form id="recipeForm">
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px">
          <div class="field"><label>Name</label><input id="rName" required /></div>
          <div class="field"><label>Tag</label>
            <select id="rTag">
              <option value="">General</option>
              <option value="Easy">Easy</option>
              <option value="Instant">Instant</option>
              <option value="Desi">Desi</option>
              <option value="Dessert">Dessert</option>
            </select>
          </div>
          <div class="field" style="grid-column: 1/3"><label>Ingredients (one per line)</label><textarea id="rIngs"></textarea></div>
          <div class="field" style="grid-column: 1/3"><label>Steps (one per line)</label><textarea id="rSteps"></textarea></div>
          <div class="field"><label>Image (optional)</label><input type="file" id="rImg" accept="image/*" /></div>
          <div class="field"><label>Cook Time (min)</label><input id="rTime" type="number" /></div>
        </div>

        <div style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 12px">
          <button type="button" id="cancelBtn" class="btn-ghost">Cancel</button>
          <button type="submit" id="saveRecipeBtn" class="btn-save">Save Recipe</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Toast & FAB -->
  <div id="toast" class="toast" style="display: none"></div>
  <button id="fab" class="fab" title="Add recipe">+</button>

  <script>
    /* -------------------- Data & storage -------------------- */
    const LS = 'tastytales.final';
    let recipes = JSON.parse(localStorage.getItem(LS) || 'null');

    function idNow() { return 'r_' + Date.now().toString(36) + Math.random().toString(36).slice(2, 7); }
    function persist() { localStorage.setItem(LS, JSON.stringify(recipes)); }

    /* default recipes (with inserted images) */
    if (!recipes || recipes.length === 0) {
      recipes = [
        { id: idNow(), name: 'Paneer Butter Masala', tag: 'Desi', ingredients: ['Paneer', 'Tomato', 'Cream', 'Butter', 'Garam masala'], steps: ['Make tomato-onion masala', 'Add paneer and simmer in gravy', 'Finish with cream & kasuri methi'], img: 'https://i.imgur.com/HZzU4Fi.jpg', time: 40, fav: false, rating: 4, section: 'ghar' },
        { id: idNow(), name: 'Aloo Paratha', tag: 'Desi', ingredients: ['Wheat flour', 'Potato', 'Spices', 'Ghee'], steps: ['Make dough', 'Prepare potato filling', 'Roll and cook on tawa'], img: 'https://i.imgur.com/6Q0I4i3.jpg', time: 30, fav: false, rating: 5, section: 'ghar' },
        { id: idNow(), name: 'Veg Pulao', tag: 'Desi', ingredients: ['Rice', 'Mixed veg', 'Spices'], steps: ['Saute veggies', 'Add rice and water', 'Cook until done'], img: 'https://i.imgur.com/6jKGVbX.jpg', time: 35, fav: false, rating: 4, section: 'ghar' },

        { id: idNow(), name: 'Medu Vada', tag: 'Easy', ingredients: ['Urad dal', 'Salt', 'Pepper', 'Green chillies', 'Curry leaves'], steps: ['Soak urad dal', 'Grind to batter', 'Shape and deep fry'], img: 'https://images.unsplash.com/photo-1604908177522-0a8472e6a27d?q=80&w=1200&auto=format&fit=crop', time: 20, fav: false, rating: 4, section: 'other' },
        { id: idNow(), name: 'Samosa', tag: 'Easy', ingredients: ['Potato', 'Peas', 'Flour', 'Spices'], steps: ['Make dough', 'Prepare filling', 'Shape samosas and fry'], img: 'https://images.unsplash.com/photo-1543779504-3a7b3d3f6e2e?q=80&w=1200&auto=format&fit=crop', time: 30, fav: false, rating: 5, section: 'other' },
        { id: idNow(), name: 'Chhole Kulcha', tag: 'Desi', ingredients: ['Chickpeas', 'Spices', 'Kulcha dough'], steps: ['Cook chhole', 'Serve with hot kulchas and chutney'], img: 'https://images.unsplash.com/photo-1622007551429-5b0f78f0d1a7?q=80&w=1200&auto=format&fit=crop', time: 40, fav: false, rating: 5, section: 'ghar' },
        { id: idNow(), name: 'Chapati (Roti)', tag: 'Desi', ingredients: ['Wheat flour', 'Water', 'Salt'], steps: ['Knead dough', 'Roll thin', 'Cook on tawa'], img: 'https://images.unsplash.com/photo-1604908810881-c1d356bda0b6?q=80&w=1200&auto=format&fit=crop', time: 20, fav: false, rating: 4, section: 'ghar' },
        { id: idNow(), name: 'Pav Bhaji', tag: 'Instant', ingredients: ['Potato', 'Tomato', 'Mixed veg', 'Pav masala'], steps: ['Boil & mash veggies', 'Cook bhaji with spices', 'Serve with buttered pav'], img: 'https://images.unsplash.com/photo-1627308595229-7830a5c91f9f?q=80&w=1200&auto=format&fit=crop', time: 25, fav: false, rating: 4, section: 'other' },
        { id: idNow(), name: 'Mango Smoothie', tag: 'Instant', ingredients: ['Mango', 'Milk', 'Honey', 'Ice'], steps: ['Blend all ingredients', 'Serve chilled'], img: 'https://i.imgur.com/zfLk9jx.jpg', time: 5, fav: false, rating: 5, section: 'other' },
        { id: idNow(), name: 'Chocolate Brownie', tag: 'Dessert', ingredients: ['Chocolate', 'Flour', 'Eggs', 'Butter', 'Sugar'], steps: ['Mix batter', 'Bake', 'Cool & serve'], img: 'https://i.imgur.com/x5ZKLGk.jpg', time: 25, fav: false, rating: 5, section: 'other' }
      ];
      persist();
    }

    /* -------------------- DOM refs -------------------- */
    const intro = document.getElementById('intro');
    const loginPage = document.getElementById('loginPage');
    const appWrap = document.getElementById('appWrap');
    const btnEnter = document.getElementById('btnEnter');
    const btnGuest = document.getElementById('btnGuest');
    const userBadge = document.getElementById('userBadge');

    const navButtons = document.querySelectorAll('#nav button');
    const homeTab = document.getElementById('homeTab');
    const savedTab = document.getElementById('savedTab');
    const gharTab = document.getElementById('gharTab');
    const instantTab = document.getElementById('instantTab');

    const gharGrid = document.getElementById('gharGrid');
    const otherGrid = document.getElementById('otherGrid');
    const savedGrid = document.getElementById('savedGrid');
    const gharOnlyGrid = document.getElementById('gharOnlyGrid');
    const instantGrid = document.getElementById('instantGrid');

    const fab = document.getElementById('fab');
    const modalWrap = document.getElementById('modalWrap');
    const recipeForm = document.getElementById('recipeForm');
    const cancelBtn = document.getElementById('cancelBtn');

    const searchInput = document.getElementById('searchInput');
    const filterBtns = document.querySelectorAll('.filter-btn');

    const detailPanel = document.getElementById('detailPanel');
    const closeDetail = document.getElementById('closeDetail');
    const detailTitle = document.getElementById('detailTitle');
    const detailImg = document.getElementById('detailImg');
    const detailIngs = document.getElementById('detailIngs');
    const detailSteps = document.getElementById('detailSteps');
    const detailTags = document.getElementById('detailTags');
    const detailFav = document.getElementById('detailFav');
    const detailRating = document.getElementById('detailRating');
    const detailEdit = document.getElementById('detailEdit');
    const detailDelete = document.getElementById('detailDelete');

    let editingId = null;
    let currentIndex = -1;
    let activeFilter = 'all';

    /* -------------------- Intro -> login flow -------------------- */
    // Enhanced animation: Bounce + rotate
    gsap.fromTo('#burger', { scale: 0, rotation: -180 }, { scale: 1.2, rotation: 0, duration: 0.8, ease: "back.out(1.8)", yoyo: true, repeat: 1 });
    setTimeout(() => {
      gsap.to(intro, { opacity: 0, duration: 0.7, onComplete: () => {
        intro.style.display = 'none';
        loginPage.style.display = 'flex';
        gsap.fromTo(loginPage, { opacity: 0, scale: 0.95 }, { opacity: 1, scale: 1, duration: 0.7, ease: "power2.out" });
      }});
    }, 2000);

    /* -------------------- Login flow -------------------- */
    btnEnter.addEventListener('click', () => {
      const name = document.getElementById('loginName').value.trim();
      const email = document.getElementById('loginEmail').value.trim();
      if (!name) { alert('Please enter your name'); return; }
      localStorage.setItem('tt_name', name);
      localStorage.setItem('tt_email', email);
      showApp(name);
    });
    btnGuest.addEventListener('click', () => {
      const name = 'Guest';
      localStorage.setItem('tt_name', name);
      showApp(name);
    });

    function showApp(name) {
      gsap.to(loginPage, { y: -30, opacity: 0, duration: 0.5, onComplete: () => {
        loginPage.style.display = 'none';
        appWrap.style.display = 'block';
        userBadge.textContent = name;
        gsap.fromTo(appWrap, { opacity: 0, y: 12 }, { opacity: 1, y: 0, duration: 0.7, ease: "power2.out" });
        renderAll();
      }});
    }

    /* -------------------- Nav tabs -------------------- */
    navButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        navButtons.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        const tab = btn.dataset.tab;
        showTab(tab);
      });
    });
    function showTab(tab) {
      homeTab.style.display = tab === 'home' ? '' : 'none';
      savedTab.style.display = tab === 'saved' ? '' : 'none';
      gharTab.style.display = tab === 'ghar' ? '' : 'none';
      instantTab.style.display = tab === 'instant' ? '' : 'none';
      window.scrollTo({ top: 0, behavior: 'smooth' });
      renderAll();
    }

    /* -------------------- Render -------------------- */
    function renderAll() {
      gharGrid.innerHTML = ''; otherGrid.innerHTML = ''; savedGrid.innerHTML = ''; gharOnlyGrid.innerHTML = ''; instantGrid.innerHTML = '';
      const q = (searchInput.value || '').trim().toLowerCase();

      const filtered = recipes.filter(r => {
        if (activeFilter === 'all') return true;
        if (activeFilter === 'Easy') return (r.tag === 'Easy' || r.tag === 'Instant');
        if (activeFilter === 'Desi') return r.tag === 'Desi';
        if (activeFilter === 'Dessert') return r.tag === 'Dessert';
        return true;
      }).filter(r => {
        if (!q) return true;
        const hay = (r.name + ' ' + (r.tag || '') + ' ' + (r.ingredients || []).join(' ')).toLowerCase();
        return hay.includes(q);
      });

      filtered.filter(r => r.section === 'ghar').forEach((r, i) => { const el = makeCard(r); gharGrid.appendChild(el); gsap.from(el, { opacity: 0, y: 20, delay: i * 0.05, duration: 0.4 }); });
      filtered.filter(r => r.section !== 'ghar').forEach((r, i) => { const el = makeCard(r); otherGrid.appendChild(el); gsap.from(el, { opacity: 0, y: 20, delay: i * 0.05, duration: 0.4 }); });

      recipes.filter(r => r.fav).forEach((r, i) => { const el = makeSavedCard(r); savedGrid.appendChild(el); gsap.from(el, { opacity: 0, y: 12, delay: i * 0.04 }); });
      recipes.filter(r => r.section === 'ghar').forEach((r, i) => { const el = makeCard(r); gharOnlyGrid.appendChild(el); });
      recipes.filter(r => r.tag === 'Instant' || r.tag === 'Easy' || r.tag === 'Healthy').forEach((r, i) => { const el = makeCard(r); instantGrid.appendChild(el); });
      persist();
    }

    function makeCard(r) {
      const el = document.createElement('div'); el.className = 'card';
      el.innerHTML = `
        <div class="thumb"><img src="${r.img}" alt="${escapeHtml(r.name)}" onerror="this.src='https://images.unsplash.com/photo-1604908810920-09bd3f812e9f?w=800'"></div>
        <h4 style="margin: 10px 0 6px">${escapeHtml(r.name)}</h4>
        <div class="meta"><div class="chip">${escapeHtml(r.tag || 'General')}</div><div style="margin-left: auto; color: rgba(0,0,0,0.55)">${r.time ? r.time + 'm' : ''}</div></div>
        <div class="card-actions">
          <button class="btn-small" onclick="openDetailById('${r.id}')">View</button>
          <button class="btn-small" onclick="toggleFav('${r.id}')">${r.fav ? '‚òÖ' : '‚òÜ'}</button>
          <div style="margin-left: 8px" class="rating">${renderStarsInline(r.rating || 0)}</div>
        </div>
      `;
      return el;
    }
    function makeSavedCard(r) {
      const el = document.createElement('div'); el.className = 'card';
      el.innerHTML = `
        <div class="thumb"><img src="${r.img}" alt="${escapeHtml(r.name)}" onerror="this.src='https://images.unsplash.com/photo-1604908810920-09bd3f812e9f?w=800'"></div>
        <h4 style="margin: 10px 0 6px">${escapeHtml(r.name)}</h4>
        <div class="meta"><div class="chip">${escapeHtml(r.tag || 'General')}</div><div style="margin-left: auto; color: rgba(0,0,0,0.55)">${r.time ? r.time + 'm' : ''}</div></div>
        <div class="card-actions">
          <button class="btn-small" onclick="openDetailById('${r.id}')">View</button>
          <button class="btn-small" onclick="removeSaved('${r.id}')">Remove</button>
          <div style="margin-left: 8px" class="rating">${renderStarsInline(r.rating || 0)}</div>
        </div>
      `;
      return el;
    }

    function escapeHtml(s) { return String(s || '').replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;'); }
    function renderStarsInline(n) {
      let out = '';
      for (let i = 1; i <= 5; i++) {
        out += `<span style="color: ${i <= n ? 'gold' : 'rgba(0,0,0,0.12)'}; font-size: 18px">‚òÖ</span>`;
      }
      return out;
    }

    /* -------------------- Detail panel & rating widget -------------------- */
    function openDetailById(id) {
      const r = recipes.find(x => x.id === id); if (!r) return;
      currentIndex = recipes.indexOf(r);
      detailTitle.textContent = r.name;
      detailImg.src = r.img || '';
      detailIngs.innerHTML = (r.ingredients || []).map(it => `<li>${escapeHtml(it)}</li>`).join('');
      detailSteps.innerHTML = (r.steps || []).map(st => `<li>${escapeHtml(st)}</li>`).join('');
      detailTags.innerHTML = `<div class="chip">${escapeHtml(r.tag || 'General')}</div>`;
      detailFav.textContent = r.fav ? '‚òÖ Favorite' : '‚òÜ Favorite';
      renderRatingWidget(detailRating, r.rating || 0, (val) => {
        recipes[currentIndex].rating = val; persist(); renderAll();
      });
      detailPanel.classList.add('open'); detailPanel.setAttribute('aria-hidden', 'false');
      gsap.fromTo(detailPanel, { x: 50, opacity: 0 }, { x: 0, opacity: 1, duration: 0.4, ease: "power2.out" });
    }
    closeDetail.addEventListener('click', () => { detailPanel.classList.remove('open'); detailPanel.setAttribute('aria-hidden', 'true'); });

    detailFav.addEventListener('click', () => {
      if (currentIndex < 0) return;
      recipes[currentIndex].fav = !recipes[currentIndex].fav; persist(); renderAll();
      detailFav.textContent = recipes[currentIndex].fav ? '‚òÖ Favorite' : '‚òÜ Favorite';
    });
    detailDelete.addEventListener('click', () => {
      if (currentIndex < 0) return;
      if (!confirm('Delete this recipe?')) return;
      recipes.splice(currentIndex, 1); currentIndex = -1; renderAll(); detailPanel.classList.remove('open');
    });
    detailEdit.addEventListener('click', () => {
      if (currentIndex < 0) return;
      openModalForEdit(recipes[currentIndex].id);
    });

    /* Toggle favorite from card */
    window.toggleFav = function(id) { const idx = recipes.findIndex(r => r.id === id); if (idx < 0) return; recipes[idx].fav = !recipes[idx].fav; persist(); renderAll(); }

    /* Remove from favorites */
    window.removeSaved = function(id) { const idx = recipes.findIndex(r => r.id === id); if (idx < 0) return; recipes[idx].fav = false; persist(); renderAll(); showToast('Removed from Favorites'); }

    /* -------------------- Modal add/edit -------------------- */
    fab.addEventListener('click', openModalForAdd);
    document.getElementById('modalClose').addEventListener('click', closeModal);
    cancelBtn.addEventListener('click', closeModal);

    function openModalForAdd() { editingId = null; recipeForm.reset(); modalWrap.style.display = 'flex'; gsap.fromTo('.modal', { y: 20, opacity: 0 }, { y: 0, opacity: 1, duration: 0.3, ease: "power2.out" }); }
    function openModalForEdit(id) { const r = recipes.find(x => x.id === id); if (!r) return; editingId = id; document.getElementById('rName').value = r.name; document.getElementById('rTag').value = r.tag || ''; document.getElementById('rIngs').value = (r.ingredients || []).join('\n'); document.getElementById('rSteps').value = (r.steps || []).join('\n'); document.getElementById('rTime').value = r.time || ''; modalWrap.style.display = 'flex'; gsap.fromTo('.modal', { y: 20, opacity: 0 }, { y: 0, opacity: 1, duration: 0.3, ease: "power2.out" }); }
    function closeModal() { gsap.to('.modal', { y: 14, opacity: 0, duration: 0.25, onComplete: () => modalWrap.style.display = 'none' }); }

    recipeForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const name = document.getElementById('rName').value.trim();
      if (!name) { alert('Recipe name required'); return; }
      const tag = document.getElementById('rTag').value;
      const ingredients = document.getElementById('rIngs').value.split('\n').map(s => s.trim()).filter(Boolean);
      const steps = document.getElementById('rSteps').value.split('\n').map(s => s.trim()).filter(Boolean);
      const time = parseInt(document.getElementById('rTime').value) || null;
      const file = document.getElementById('rImg').files[0];
      let imgData = null;
      if (file) { imgData = await readFileAsDataURL(file); }
      const payload = { id: editingId || idNow(), name, tag, ingredients, steps, time, img: imgData || 'https://images.unsplash.com/photo-1604908810920-09bd3f812e9f?w=800', fav: false, rating: 0, section: (tag === 'Desi') ? 'ghar' : 'other' };
      if (editingId) { const idx = recipes.findIndex(r => r.id === editingId); if (idx >= 0) recipes[idx] = { ...recipes[idx], ...payload }; showToast('Recipe updated'); }
      else { recipes.unshift(payload); showToast('Recipe saved'); }
      persist(); renderAll(); closeModal();
    });

    /* File helper */
    function readFileAsDataURL(file) { return new Promise((res, rej) => { const fr = new FileReader(); fr.onload = () => res(fr.result); fr.onerror = rej; fr.readAsDataURL(file); }); }

    /* Search & filters */
    searchInput.addEventListener('input', () => renderAll());
    filterBtns.forEach(btn => btn.addEventListener('click', () => { activeFilter = btn.dataset.filter; filterBtns.forEach(b => b.classList.remove('active')); btn.classList.add('active'); renderAll(); }));

    /* Rating widget */
    function renderRatingWidget(container, initial = 0, onChange) {
      container.innerHTML = '';
      for (let i = 1; i <= 5; i++) {
        const star = document.createElement('span');
        star.innerHTML = '‚òÖ';
        star.style.fontSize = '22px';
        star.style.cursor = 'pointer';
        star.style.color = (i <= initial) ? 'gold' : 'rgba(0,0,0,0.16)';
        star.addEventListener('mouseenter', () => {
          for (let j = 1; j <= 5; j++) container.children[j - 1].style.color = j <= i ? 'gold' : 'rgba(0,0,0,0.16)';
        });
        star.addEventListener('mouseleave', () => {
          for (let j = 1; j <= 5; j++) container.children[j - 1].style.color = j <= initial ? 'gold' : 'rgba(0,0,0,0.16)';
        });
        star.addEventListener('click', () => {
          initial = i;
          if (onChange) onChange(i);
          for (let j = 1; j <= 5; j++) container.children[j - 1].style.color = j <= initial ? 'gold' : 'rgba(0,0,0,0.16)';
          showToast('Rated ' + i + ' star' + (i > 1 ? 's' : ''));
        });
        container.appendChild(star);
      }
    }

    /* Toast */
    function showToast(msg, dur = 1600) { const t = document.getElementById('toast'); t.textContent = msg; t.style.display = 'block'; gsap.fromTo(t, { y: 25, opacity: 0 }, { y: 0, opacity: 1, duration: 0.2 }); setTimeout(() => gsap.to(t, { opacity: 0, duration: 0.3, onComplete: () => t.style.display = 'none' }), dur); }

    /* Init */
    function init() {
      const name = localStorage.getItem('tt_name');
      if (name) { showApp(name); }
    }
    init();

    /* Expose helpers */
    window.openDetailById = openDetailById;

    /* ESC handlers */
    document.addEventListener('keydown', (e) => { if (e.key === 'Escape') { closeModal(); detailPanel.classList.remove('open'); } });
  </script>
</body>
</html>